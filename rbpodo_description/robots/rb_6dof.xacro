<?xml version='1.0' encoding='utf-8'?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:macro name="link" params="name model_id:=^ has_inertial:=true prefix=''">
    <xacro:property name="links_props_file" value="$(find rbpodo_description)/robots/${model_id}/link.yaml" />
    <xacro:property name="links_props" value="${xacro.load_yaml(links_props_file)}" />

    <link name="${prefix}${name}">
      <visual>
        <geometry>
          <mesh filename="package://rbpodo_description/meshes/${model_id}/visual/${name}.dae" />
        </geometry>
      </visual>

      <collision>
        <geometry>
          <mesh filename="package://rbpodo_description/meshes/${model_id}/collision/${name}.stl" />
        </geometry>
      </collision>

      <xacro:if value="${has_inertial}">
        <!-- Check whether this property is available or not -->
        <xacro:property name="props" value="${links_props[name]}" />
        <xacro:property name="inertial" value="${props.inertial}" />
        <inertial>
          <origin rpy="${inertial.origin.rpy}" xyz="${inertial.origin.xyz}" />
          <mass value="${inertial.mass}" />
          <xacro:property name="I" value="${inertial.inertia}" />
          <inertia ixx="${I.xx}" ixy="${I.xy}" ixz="${I.xz}" iyy="${I.yy}" iyz="${I.yz}" izz="${I.zz}" />
        </inertial>
      </xacro:if>
    </link>
  </xacro:macro>

  <xacro:macro name="joint" params="name model_id:=^ prefix=''">
    <xacro:property name="joints_props_file" value="$(find rbpodo_description)/robots/${model_id}/joint.yaml" />
    <xacro:property name="joints_props" value="${xacro.load_yaml(joints_props_file)}" />
    <!-- Check whether name is in joints_props or not -->
    <xacro:property name="props" value="${joints_props[name]}" />
    <joint name="${prefix}${name}" type="revolute">
      <origin xyz="${props.origin.xyz}" rpy="${props.origin.rpy}" />
      <parent link="${prefix}${props.parent}" />
      <child link="${prefix}${props.child}" />
      <axis xyz="${props.axis.xyz}" />

      <xacro:property name="limit" value="${props.limit}" />
      <limit lower="${limit.lower}" upper="${limit.upper}" effort="${limit.effort}" velocity="${limit.velocity}" />
    </joint>
  </xacro:macro>

  <xacro:macro name="rb_6dof" params="model_id prefix='' tcp_name='tcp' tcp_xyz='0 0 0' tcp_rpy='0 0 0'">
    <xacro:link name="link0" model_id="${model_id}" prefix="${prefix}" has_inertial="false" />
    <xacro:link name="link1" model_id="${model_id}" prefix="${prefix}" />
    <xacro:link name="link2" model_id="${model_id}" prefix="${prefix}" />
    <xacro:link name="link3" model_id="${model_id}" prefix="${prefix}" />
    <xacro:link name="link4" model_id="${model_id}" prefix="${prefix}" />
    <xacro:link name="link5" model_id="${model_id}" prefix="${prefix}" />
    <xacro:link name="link6" model_id="${model_id}" prefix="${prefix}" />
    <link name="${prefix}${tcp_name}" />

    <xacro:joint name="base" model_id="${model_id}" prefix="${prefix}" />
    <xacro:joint name="shoulder" model_id="${model_id}" prefix="${prefix}" />
    <xacro:joint name="elbow" model_id="${model_id}" prefix="${prefix}" />
    <xacro:joint name="wrist1" model_id="${model_id}" prefix="${prefix}" />
    <xacro:joint name="wrist2" model_id="${model_id}" prefix="${prefix}" />
    <xacro:joint name="wrist3" model_id="${model_id}" prefix="${prefix}" />
    <joint name="${prefix}${tcp_name}_joint" type="fixed">
      <origin xyz="${tcp_xyz}" rpy="${tcp_rpy}" />
      <parent link="${prefix}link6" />
      <child link="${prefix}${tcp_name}" />
    </joint>

  </xacro:macro>

</robot>
